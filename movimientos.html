<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historial de Movimientos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #d1d5db;
        }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">
    <div class="max-w-4xl mx-auto">
        <header class="flex flex-col sm:flex-row items-center justify-between mb-8 gap-4">
            <div>
                <h1 class="text-3xl font-bold text-white">Historial de Movimientos</h1>
                <p class="text-gray-400 mt-1">Un registro de todas tus operaciones.</p>
            </div>
            <a href="./index.html" class="w-full sm:w-auto px-5 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                </svg>
                Volver al Asistente
            </a>
        </header>

        <div id="loading-message" class="text-center text-gray-400 py-10">
            <p>Cargando historial...</p>
        </div>

        <div id="transactions-list" class="space-y-3">
            <!-- Las transacciones se renderizarán aquí -->
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // **ACCIÓN REQUERIDA**: TU CONFIGURACIÓN DE FIREBASE YA ESTÁ AQUÍ.
        const firebaseConfig = {
          apiKey: "AIzaSyA6qN_uF3ljC3MuzVgXc0IcQdNXHdYdVZQ",
          authDomain: "asistente-financiero-de-luis.firebaseapp.com",
          projectId: "asistente-financiero-de-luis",
          storageBucket: "asistente-financiero-de-luis.appspot.com",
          messagingSenderId: "1042510262841",
          appId: "1:1042510262841:web:46a4a02d88c3cc1523d3e8"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const transactionsList = document.getElementById('transactions-list');
        const loadingMessage = document.getElementById('loading-message');

        function getTransactionVisuals(type, amount) {
            if (type === 'income' || amount > 0) {
                return {
                    icon: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01"/></svg>`,
                    color: 'text-green-400',
                    bgColor: 'bg-green-500/10'
                };
            }
            if (type === 'expense' || amount < 0) {
                 return {
                    icon: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01"/></svg>`,
                    color: 'text-red-400',
                    bgColor: 'bg-red-500/10'
                };
            }
            return {
                icon: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l-4 4-4-4 4-4"/></svg>`,
                color: 'text-blue-400',
                bgColor: 'bg-blue-500/10'
            };
        }

        async function fetchAndDisplayTransactions() {
            try {
                const q = query(collection(db, "transactions"), orderBy("date", "desc"));
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    loadingMessage.innerText = "No se encontraron transacciones en tu historial.";
                    return;
                }

                loadingMessage.style.display = 'none';
                
                querySnapshot.forEach((doc) => {
                    const transaction = doc.data();
                    const date = transaction.date ? transaction.date.toDate().toLocaleString('es-ES', { day: '2-digit', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' }) : 'Fecha no disponible';
                    const visuals = getTransactionVisuals(transaction.type, transaction.amount);
                    
                    const transactionElement = document.createElement('div');
                    transactionElement.className = 'bg-gray-800 p-4 rounded-lg flex items-center space-x-4 hover:bg-gray-700/50 transition-colors';
                    
                    const amount = transaction.amount || 0;
                    
                    transactionElement.innerHTML = `
                        <div class="flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center ${visuals.bgColor} ${visuals.color}">
                           ${visuals.icon}
                        </div>
                        <div class="flex-grow">
                            <p class="font-semibold text-white">${transaction.description || 'Sin descripción'}</p>
                            <p class="text-sm text-gray-400">${date}</p>
                        </div>
                        <div class="text-lg font-bold ${visuals.color} text-right">
                            ${amount > 0 ? '+' : ''}${amount.toLocaleString('es-ES', {style: 'currency', currency: 'MXN'})}
                        </div>
                    `;
                    transactionsList.appendChild(transactionElement);
                });

            } catch (error) {
                console.error("Error al cargar transacciones:", error);
                loadingMessage.innerText = `Error al cargar el historial: ${error.message}`;
                loadingMessage.classList.add('text-red-400');
            }
        }

        window.onload = fetchAndDisplayTransactions;
    </script>
</body>
</html>
